# Let us now explore monitoring with Jenkins. To do this we have installed Prometheus and Grafana on the same machine called jenkins-server


As before, you can use the standard admin credentials to login to the Jenkins UI:
Username: admin

Password: Adm!n321


You can also access the Prometheus UI by clicking on the Prometheus button located above the terminal.


# To setup monitoring with prometheus in Jenkins, please install the plugins mentioned below.


You need to install Prometheus metrics plugin, you can refer to the plugin documentation by clicking on the Prometheus Docs button located above the terminal.


Once the plugins have been downloaded, restart Jenkins.

CheckCompleteIncomplete
Prometheus metrics plugin installed?


Login into the Jenkins server and follow the below given steps:

1. Go to Manage Jenkins.
2. Click on Plugins.
3. Under Available, search for Prometheus metrics plugin.
4. Select it and install.
5. Once installed click on Restart Jenkins when installation is complete and no jobs are running.


# Which endpoint is the prometheus plugin exposed on by default?

Login into the Jenkins server and follow the below given steps:


1. Go to Manage Jenkins.

2. Click on System.

3. Look into the Prometheus section.

4. The default path should be set to prometheus

# Navigate to the endpoint /prometheus/ and you should be able to see the output generated by the Prometheus plugin.


As an example, if your Jenkins URL is https://8085-port-acc228e844d64736.labs.kodekloud.com then you can view the metrics at the URL: https://8085-port-acc228e844d64736.labs.kodekloud.com/prometheus/

# Navigate to the Prometheus UI and answer the below questions.

Which target(s) have been configured within the Prometheus configuration?

Click on the button called Prometheus and then navigate to --> Status --> Targets and inspect the targets that are UP.
As of now, only the Prometheus target should be available.

# Let us now add a scrape config for Jenkins. Update the prometheus configuration file located at /etc/prometheus/prometheus.yml and add the following config under the scrape_configs section:

```ruby
- job_name: 'Jenkins'
    metrics_path: /prometheus/
    static_configs:
      - targets: ['localhost:8085']
```

Once the file is updated, restart prometheus using the below command:

service prometheus restart 


Wait for few seconds before submitting your question.


Note: Here localhost:8085 refers to our Jenkins Controller and the /prometheus/ metrics path is exposed by the prometheus-metrics plugin that we installed previously`

CheckCompleteIncomplete
'Jenkins' target added ?


1. Edit /etc/prometheus/prometheus.yml file

`vi /etc/prometheus/prometheus.yml`



2. Under scrape_configs section add

```ruby
- job_name: 'Jenkins'
    metrics_path: /prometheus/
    static_configs:
      - targets: ['localhost:8085']
```

3. Then save the file

4. Restart Prometheus Service:

`service prometheus restart`

# To see the status of the configuration we used within /etc/prometheus/prometheus.yml file, refresh the Prometheus UI and then navigate to the drop down button called Status and click on Configuration.


Here, you should be able to see the global configuration and configuration for specific targets such as Prometheus and Jenkins.

# Now lets test out some queries in Prometheus. Go back to the Prometheus home page (by clicking on the Prometheus button within the UI) and execute the following query:

jenkins_job_count_value

What value you got in the output?

1. Click on the Prometheus button on the top of the terminal.

2. Enter the query under Expression

jenkins_job_count_value



3. Then click on Execute button.

4. Look for the Value of the Element.
![Screenshot from 2023-10-29 12-58-44](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/027072b8-b599-49c1-a31f-8228ebad2ef9)



# Let us see now, how we can use Grafana to visualise Jenkins metrics. Grafana is already installed and can be accessed using Grafana button on the top of the terminal.

Grafana credentials are:

UserName: admin

Password: admin


Note:Set a new password admin123 for the admin user.



First of all, let us add Prometheus datasource in Grafana. Follow below given steps for that:

-> Login into Grafana and click on Add your first datasource.

-> Then select Prometheus and enter http://localhost:9090 in the URL box.

-> Finally click on Save and test button at the bottom.

-> Click on Grafana logo to move back to the dashboard.

CheckCompleteIncomplete
Prometheus datasource added?
![Screenshot from 2023-10-29 13-03-47](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/c605f4fb-7186-4fa5-a3b7-e53986e41a9f)

![image](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/5b708fe9-ad4e-4ce3-a533-ebc3040d1a9d)

![image](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/2e9bc445-91e6-467e-8e1d-60bf915049d3)

# Let us create a dashboard in Grafana now to visualise the total number of Jenkins jobs.


Use same Grafana credentials to login:

UserName: admin

Password: admin123


Follow below given steps to create a dashboard in Grafana:


-> Login into Grafana and click on Create your first dashboard.
![image](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/07976097-1da7-4656-9a37-15285ea353b7)
-> Then click on Add visualization and at the bottom enter jenkins_job_count_value in the Metrics browser box.
![image](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/cfb6c86c-778b-4e8e-a898-5cb8175065a7)


-> Make sure Prometheus is selected as the Data source.

-> On the right side under Panel options, enter Jenkins Jobs Count in Title.

-> Click on Apply button on the top right corner.

-> Finally click on the Save dashboard button (second button on the top right).

![Screenshot from 2023-10-29 13-14-12](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/1afc7e6b-f2f4-454a-95df-d09b15586643)

-> Enter dashboard name as Jenkins and save it.

![image](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/dfd99e9f-84a5-48f3-ac16-fdf17c03c8a3)

CheckCompleteIncomplete
Jenkins dashboard created?



# As per the Grafana dashboard, how many Jenkins jobs are there?


Make sure to look for the latest metrics in the dashboard. For that click on the time navigator option on the top right and then select Last 5 minutes.


Note: Close and open the Grafana again if no changes are reflecting and wait a little as sometimes changes can take few seconds to reflect.

![image](https://github.com/Althaf-official/KodeKloud_Jenkins/assets/105126131/9b82da51-4e90-4179-b327-870a956c1c7a)









